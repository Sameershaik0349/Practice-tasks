show databases;
create database joins;
use joins;
create table customers (cus_id int PRIMARY key,first_name varchar(20),last_name varchar(20),email varchar(20),
phone_number BIGINT,address TEXT,date_joined DATE);

desc customers

create table orders (
ord_id int primary KEY,
cus_id INT,
order_date DATE,
total_amount FLOAT,
shipping_adress text,
payment_status varchar(20));

create table products (
    product_id int PRIMARY key,
    name varchar(20),
    description_ text,
    price  float,
    stock_quantity int,
    category_id INT
);

create table categories (
    category_id int primary key,
    category_name varchar(20),
    description_ TEXT
)

create table order_items(
    order_items_id int primary KEY,
    ord_id INT,
    product_id int,
    quantity int,
    item_price float
);


INSERT INTO customers VALUES
(1, 'Rahul', 'Sharma', 'rahul@gmail.com', 9876543210, 'Hyderabad', '2024-01-10'),
(2, 'Anita', 'Verma', 'anita@gmail.com', 9123456780, 'Bangalore', '2024-02-05'),
(3, 'Amit', 'Kumar', 'amit@gmail.com', 9988776655, 'Chennai', '2024-03-15');

INSERT INTO categories VALUES
(1, 'Electronics', 'Electronic Items'),
(2, 'Clothing', 'Fashion & Wear'),
(3, 'Books', 'Educational Books');

INSERT INTO products VALUES
(101, 'Mobile', 'Smart Phone', 15000, 10, 1),
(102, 'Laptop', 'Gaming Laptop', 55000, 5, 1),
(103, 'T-Shirt', 'Cotton T-Shirt', 800, 20, 2),
(104, 'Python Book', 'Programming Book', 500, 15, 3);

INSERT INTO orders VALUES
(1001, 1, '2024-04-01', 15800, 'Hyderabad', 'PAID'),
(1002, 2, '2024-04-03', 55000, 'Bangalore', 'PAID'),
(1003, 1, '2024-04-10', 500, 'Hyderabad', 'PENDING');

INSERT INTO order_items VALUES
(1, 1001, 101, 1, 15000),
(2, 1001, 103, 1, 800),
(3, 1002, 102, 1, 55000),
(4, 1003, 104, 1, 500);

SELECT * FROM customers;
SELECT * FROM categories;
SELECT * FROM products;
SELECT * FROM orders;
SELECT * FROM order_items;

-- 1.	Join the Customers table with the Orders table to list all orders made by a specific customer.
select * from customers join orders on customers.cus_id = orders.cus_id where customers.first_name='rahul';

-- 2.	Find all orders placed by customers who live in a specific city (using the address field in Customers table).
select  orders.*,customers.first_name from customers join orders on customers.cus_id = orders.cus_id where customers.address = "hyderabad";
-- 3.	List the products and their categories by joining the Products and Categories tables.
SELECT * from products join categories on products.category_id = categories.category_id;

-- 4.	Get a list of all products purchased by a particular customer, including their name, description, and quantity ordered (using Orders, Order_Items, and Products).
SELECT 
    p.product_id,
    p.name,
    p.description_,
    oi.quantity
FROM orders o
JOIN order_items oi
    ON o.ord_id = oi.ord_id
JOIN products p
    ON oi.product_id = p.product_id
WHERE o.cus_id = 1;

-- 5.	Join Order_Items with Orders to get a list of all products ordered along with the order's total amount


select o.ord_id as order_id,
p.name as products_name,
total_amount as amount 
from orders o join order_items oi on o.ord_id =oi.ord_id join products p on p.product_id =oi.product_id;


-- 6  Find the total number of items ordered for each product (using Order_Items and Products).
select SUM(oi.quantity) as items_ordered,
p.name as product_name
from order_items oi JOIN
products p 
on oi.product_id = p.product_id
group by p.name;



-- 7 Find the customer who placed the highest value order (using Orders and Customers).
SELECT o.total_amount as amount,
c.first_name as name from orders o join customers C
on o.cus_id =c.cus_id order by o.total_amount desc limit 1
;


-- 8 Get a list of all customers who ordered a specific product (join Customers, Orders, and Order_Items).

select DISTINCT c.first_name,oi.product_id  from orders o  join  customers c on  o.cus_id =c .cus_id join order_items oi on o.ord_id=oi.ord_id where oi.product_id =101


-- 9 Join Products and Order_Items to find the total revenue generated by each product.



SELECT sum(oi.item_price * oi.quantity) as revenue,
p.name from products p  join order_items oi
on p.product_id=oi.product_id group by p.name;


-- 10 Find the most popular product in each category (using Products, Order_Items, and Categories).
use joins;

select cat.category_name as category,
p.name as products_name,sum(oi.quantity)
from products p join order_items oi
on p.product_id=oi.product_id
join categories cat on p.category_id =cat.category_id group by cat.category_name ,p.name;



-- Get a list of all orders with their corresponding products, including product name and quantity ordered (using Orders, Order_Items, and Products).

select o.ord_id as orders,
p.name as product_name,
oi.quantity
from orders o join order_items oi
on o.ord_id = oi.ord_id join products p on oi.product_id = p.product_id;


-- Find the average number of items ordered per customer (using Orders and Order_Items).


select avg(oi.quantity),
o.cus_id from order_items oi join orders o
on oi.ord_id=o.ord_id group by o.cus_id;


SELECT 
    cus_id,
    AVG(quantity) AS avg_items_per_customer
FROM orders
NATURAL JOIN order_items
GROUP BY cus_id;


-- List customers who have not placed any orders (using Customers and Orders).

select customers.*,orders.ord_id from customers JOIN orders on customers.cus_id=orders.cus_id where orders.ord_id='null'


select customers.*,orders.* from customers natural join orders where orders.ord_id ='null'

SELECT c.*
FROM customers c
LEFT JOIN orders o
    ON c.cus_id = o.cus_id
WHERE o.ord_id IS NULL;

-- Find all orders that contain more than 5 items, including customer details (using Orders, Order_Items, and Customers).;

SELECT 
    o.ord_id,
    c.cus_id,
    c.first_name,
    SUM(oi.quantity) AS total_items
FROM orders o
JOIN order_items oi
    ON o.ord_id = oi.ord_id
JOIN customers c
    ON o.cus_id = c.cus_id
GROUP BY o.ord_id, c.cus_id, c.first_name
HAVING SUM(oi.quantity) >=2;

use joins;


-- List the total number of products sold per category (using Products, Order_Items, and Categories).

SELECT 
    category_name,
    SUM(quantity) AS total_products_sold
FROM products
NATURAL JOIN order_items
NATURAL JOIN categories
GROUP BY category_name;


-- Find all orders placed in the last 30 days along with the products purchased (using Orders, Order_Items, and Products).

SELECT 
    ord_id,
    name AS product_name,
    quantity
FROM orders
NATURAL JOIN order_items
NATURAL JOIN products
WHERE order_date >= CURRENT_DATE - INTERVAL 30 DAY;


-- Get a list of products that are out of stock and were previously ordered (using Products and Order_Items).

SELECT DISTINCT
    product_id,
    name
FROM products
NATURAL JOIN order_items
WHERE stock_quantity = 0;


-- List the products that have not been sold in the last 6 months (using Products and Order_Items).
SELECT 
    product_id,
    name
FROM products
WHERE product_id NOT IN (
    SELECT product_id
    FROM order_items
    NATURAL JOIN orders
    WHERE order_date >= CURRENT_DATE - INTERVAL 6 MONTH
);


-- Find customers who have placed orders above a certain value threshold, with order details (using Orders, Customers).

SELECT 
    cus_id,
    first_name,
    ord_id,
    total_amount
FROM customers
NATURAL JOIN orders
WHERE total_amount > 20000;
